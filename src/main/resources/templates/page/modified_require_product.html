<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>修改求购商品</title>
    <link rel="icon" href="/img/page_icon.png"/>
    <link rel="stylesheet" href="/css/home_page/header_and_nav.css"/>
    <link rel="stylesheet" href="/css/product/require_product.css"/>
    <script src="/js/jquery-1.3.2.min.js"></script>
    <script src="/js/home/header_model_js.js"></script>
    <script src="/js/mall/type_list_obj.js"></script>
    <script src="/js/publish/publish_product.js"></script>
</head>
<body>
<header th:include="header :: copy"></header>
<div th:include="short_nav_show :: short_nav_show" class="short_nav_show"></div>
<nav th:include="my_nav :: my_nav" class="my_nav"></nav>
<div th:include="personal_nav :: personal_nav" class="personal_nav"></div>
<!--name,sort,quantity,price,remark,token,-->
<div class="top_content">
    <div class="publish_product_div">
        <form action="/updateUserWant.do" method="post" onsubmit="return validateForm()">
            <input type="hidden" th:value="${token}" name="token"/>
            <input type="hidden" th:value="${userWant.id}" name="id"/>
            <div class="publish_one_par">
                <div class="publish_title">
                    <h3>商品名</h3>
                </div>
                <div class="publish_content">
                    <input type="text" class="title_input" name="name" required="required" th:value="${userWant.name}"/>
                </div>
            </div>
            <div class="publish_one_par">
                <div class="publish_title">
                    <h3>数量</h3>
                </div>
                <div class="publish_content">
                    <input type="number" class="count_input" name="quantity" required="required" min="1" th:value="${userWant.quantity}"/>
                </div>
            </div>
            <div class="publish_one_par">
                <div class="publish_title">
                    <h3>单价</h3>
                </div>
                <div class="publish_content cost_content">
                    <input type="number" class="cost_input" name="price" required="required" min="0" step="0.01" th:value="${userWant.price}"/>
                    <span>RMB(.00)</span>
                </div>
            </div>
            <div class="publish_one_par">
                <div class="publish_title">
                    <h3>详情</h3>
                </div>
                <div class="publish_content">
                    <textarea class="detail_textarea" maxlength="122" placeholder="留下联系方式,方便卖家联系" 
                              name="remark" required="required" th:text="${userWant.remark}"></textarea>
                </div>
            </div>
            <div class="publish_one_par">
                <div class="publish_title">
                    <h3>分类</h3>
                </div>
                <div class="publish_content">
                    <select class="choose_first_type">
                        <option id="type_1" selected="selected">文学与艺术类</option>
                        <option id="type_2">科学与技术类</option>
                        <option id="type_3">人文社科类</option>
                        <option id="type_4">经济与管理类</option>
                        <option id="type_5">生活与休闲类</option>
                        <option id="type_6">教育与学习类</option>
                    </select>
                    <select class="choose_second_type">
                    </select>
                    <select class="choose_third_type" name="sort" required="required">
                    </select>
                </div>
            </div>
            <div class="submit_content_div">
                <input type="submit" value="提交" class="submit_input"/>
            </div>
        </form>
    </div>
    <footer>
        <p>Copyright © 2025.Company name All rights reserved.<a href="/"></a></p>
    </footer>
</div>
<script>
function validateForm() {
    var sort = document.querySelector('.choose_third_type').value;
    if (!sort) {
        alert('请选择完整的分类信息');
        return false;
    }
    return true;
}

// 初始化当前商品的分类
$(document).ready(function() {
    // 获取当前求购商品的分类ID
    var currentSort = '[[${userWant.sort}]]';
    
    if (currentSort && currentSort !== 'null') {
        // 先通过AJAX获取当前分类的完整信息
        $.ajax({
            url: '/getFullCategoryInfo.do',
            type: 'POST',
            dataType: 'JSON',
            data: {sort: currentSort},
            success: function(result) {
                if (result) {
                    // 设置一级分类
                    $('.choose_first_type option').each(function() {
                        if ($(this).attr('id') === 'type_' + result.aid) {
                            $(this).prop('selected', true);
                        }
                    });
                    
                    // 触发一级分类change事件来加载二级分类
                    $('.choose_first_type').trigger('change');
                    
                    // 等待二级分类加载完成后设置选中值
                    var secondInterval = setInterval(function() {
                        var secondSelect = $('.choose_second_type');
                        if (secondSelect.children().length > 0) {
                            secondSelect.val(result.cid);
                            secondSelect.trigger('change');
                            clearInterval(secondInterval);
                            
                            // 等待三级分类加载完成后设置选中值
                            var thirdInterval = setInterval(function() {
                                var thirdSelect = $('.choose_third_type');
                                if (thirdSelect.children().length > 0) {
                                    thirdSelect.val(currentSort);
                                    clearInterval(thirdInterval);
                                }
                            }, 100);
                        }
                    }, 100);
                }
            }
        });
    }
});
</script>
</body>
</html>